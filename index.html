<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Space Station</title>
<style>
body {
    margin: 0;
    overflow: hidden;
    background: #050816;
}
#hint {
    position: absolute;
    bottom: 20px;
    width: 100%;
    text-align: center;
    color: #00eaff;
    font-size: 14px;
}
</style>
</head>
<body>

<div id="hint">ðŸš€ Arraste a nave</div>

<!-- PIXI V7 FIXA -->
<script src="https://cdn.jsdelivr.net/npm/pixi.js@7.3.2/dist/pixi.min.js"></script>

<script>

const app = new PIXI.Application({
    resizeTo: window,
    backgroundColor: 0x050816
});
document.body.appendChild(app.view);

const loader = new PIXI.Loader();

loader
.add("ship", "assets/ship.png")
.add("station", "assets/station_bg.png")
.load(setup);

function setup(loader, resources) {

    // ESTAÃ‡ÃƒO
    const station = new PIXI.Sprite(resources.station.texture);
    station.anchor.set(0.5);
    station.x = app.screen.width / 2;
    station.y = app.screen.height / 2;

    const scale = Math.max(
        app.screen.width / station.texture.width,
        app.screen.height / station.texture.height
    );
    station.scale.set(scale);

    app.stage.addChild(station);

    // NAVE
    const ship = new PIXI.Sprite(resources.ship.texture);
    ship.anchor.set(0.5);
    ship.x = app.screen.width * 0.7;
    ship.y = app.screen.height * 0.5;
    ship.scale.set(0.6);
    ship.interactive = true;

    app.stage.addChild(ship);

    // CONTROLE
    let dragging = false;

    ship
    .on("pointerdown", () => dragging = true)
    .on("pointerup", () => dragging = false)
    .on("pointerupoutside", () => dragging = false)
    .on("pointermove", (event) => {
        if (dragging) {
            const pos = event.data.global;
            ship.x += (pos.x - ship.x) * 0.1;
            ship.y += (pos.y - ship.y) * 0.1;
        }
    });

    // CHUVA
    const rain = [];

    for (let i = 0; i < 200; i++) {
        const drop = new PIXI.Graphics();
        drop.beginFill(0x00eaff);
        drop.drawRect(0, 0, 2, 10);
        drop.endFill();

        drop.x = Math.random() * app.screen.width;
        drop.y = Math.random() * app.screen.height;
        drop.speed = 5 + Math.random() * 5;

        rain.push(drop);
        app.stage.addChild(drop);
    }

    app.ticker.add(() => {
        rain.forEach(drop => {
            drop.y += drop.speed;

            if (drop.y > app.screen.height) {
                drop.y = -10;
                drop.x = Math.random() * app.screen.width;
            }
        });
    });
}

</script>
</body>
</html>
